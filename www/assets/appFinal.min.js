var app=angular.module("MovieRating",["ngCookies","ngAnimate","ngSanitize","ngTouch","ui.router","ui.bootstrap","720kb.datepicker","ngDialog","app.controllers","app.routes","app.services","app.factories","app.directives","app.constants","app.filters"]).run(["$rootScope","$state","Auth","$window","$cookies",function(e,r,o,t,n){e.$on("$stateChangeStart",function(o,i,l,a,c,s){!n.get("connect.sid")&&"login"!==i.name&&i.authenticate&&(o.preventDefault(),r.go("login")),!e.page_title&&t.page_title&&(e.page_title=t.page_title)}),e.$on("$stateChangeSuccess",function(){document.body.scrollTop=document.documentElement.scrollTop=0,e.currentState=r.current}),!e.currentUser&&n.get("connect.sid")&&o.refresh()}]),env=window.env||"development",baseUrl,shopUrl;baseUrl="development"!==env?"/api":"//localhost:3000/api",angular.module("app.constants",[]).constant("CONFIG",{version:1,dateFormat:"MM/dd/yyyy",timeFormat:"h:mm a",dateTimeFormat:"M/d/yyyy h:mm a",url:baseUrl,socketUrl:baseUrl,omdbUrl:"http://www.omdbapi.com/"});var directiveDirectory="/templates/directives/";angular.module("app.directives",[]).directive("header",function(){return{restrict:"E",scope:!1,templateUrl:directiveDirectory+"header.html"}}).directive("navbar",function(){return{restrict:"E",scope:!1,templateUrl:directiveDirectory+"navbar.html"}}).directive("footer",function(){return{restrict:"E",scope:!1,templateUrl:directiveDirectory+"footer.html"}}),angular.module("app.factories",[]).factory("Auth",["$rootScope","$http","$state","$q","CONFIG","$window","$cookies",function(e,r,o,t,n,i,l){function a(e){return console.log("Factory register function hit!"),t(function(o,t){r.post(n.url+"/users/register",e).then(function(e){return console.log("The factory register response: ",e),o(e.data)},function(e){return console.log("The factory register error: ",e),t(e)})})}function c(e,o){return t(function(t,i){r.post(n.url+"/users/login",{email:e,password:o}).then(function(e){return t(e.data)},function(e){return console.log("The factory login error: ",e),i(e)})})}function s(){return t(function(o,t){r.post(n.url+"/users/logout").then(function(r){return e.currentUser=null,l.remove("connect.sid"),o("Successfully logged out!")},function(e){return l.remove("connect.sid"),t("Failed to log out user")})})}function u(){return r.post(n.url+"/users/refresh").then(function(r){var o=r.data;e.currentUser={id:o.id,email:o.email,firstName:o.firstName,lastName:o.lastName}},function(e){console.error("Error loading user on refresh: ",e)})}return{register:a,login:c,logout:s,refresh:u}}]),angular.module("app.filters",[]).filter("dateSeparator",["$filter",function(e){var r=e("date");return function(e,o){return r(e,"MM"+o+"dd"+o+"yyyy")}}]).filter("dateYearOnly",["$filter",function(e){e("date");return function(e){var r=new Date(e),o=r.getFullYear();return o}}]),angular.module("app.routes",["ui.router"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","$urlMatcherFactoryProvider",function(e,r,o,t,n){r.rule(function(e,r){var o=r.path(),t="/"===o[o.length-1];if(t){var n=o.substr(0,o.length-1);return n}}),n.strictMode(!1),e.state("404",{templateUrl:"/templates/404.html",controller:"errorController",params:{error:null}}).state("login",{url:"/login",templateUrl:"/templates/login.html",controller:"LoginController",authenticate:!1}).state("register",{url:"/register",templateUrl:"/templates/register.html",controller:"RegisterController",authenticate:!1}).state("index",{url:"",templateUrl:"/templates/homepage.html",controller:"HomepageController",authenticate:!1}).state("index.feed",{url:"/feed",templateUrl:"/templates/feed.html",controller:"FeedController",authenticate:!1}).state("index.movies",{url:"/movies",templateUrl:"/templates/movies.html",controller:"MoviesController",authenticate:!1}).state("index.movies.movie",{url:"/{movieId}",templateUrl:"/templates/movie.html",controller:"MovieController",params:{movieId:null},authenticate:!1}).state("index.person",{url:"/person/{personId}",templateUrl:"/templates/person.html",controller:"PersonController",params:{personId:null},authenticate:!1}).state("index.profile",{url:"/profile",templateUrl:"/templates/profile.html",controller:"ProfileController",authenticate:!0}),o.html5Mode({enabled:!0,requireBase:!1}),r.when("","/"),r.otherwise(function(e,r){e.invoke(["$state",function(e){e.go("404")}])})}]).run(["$rootScope","$state",function(e,r){e.$state=r}]),angular.module("app.services",[]).service("MovieService",["$http","CONFIG","$q",function(e,r,o){this.getMovies=function(){return o(function(o,t){e.get(r.url+"/movies").then(function(e){return e.data.length>0?o(e):t("No movies yet")},function(e){return t("Error loading movies")})})}}]).service("OMDBService",["$http","CONFIG","$q",function(e,r,o){this.getMoviesByTitle=function(t){return o(function(o,n){e.get(r.url+"/movie-search/"+t).then(function(e){return o(e)},function(e){return n(e)})})},this.getMovieById=function(t){return o(function(o,n){e.get(r.url+"/movie-search/by-id/"+t).then(function(e){return o(e)},function(e){return n(e)})})},this.getMovieCreditsById=function(t){return o(function(o,n){e.get(r.url+"/movie-search/"+t+"/credits").then(function(e){return o(e)},function(e){return n(e)})})},this.getMovieImagesById=function(t){return o(function(o,n){e.get(r.url+"/movie-search/"+t+"/images").then(function(e){return o(e)},function(e){return n(e)})})},this.getPersonById=function(t){return o(function(o,n){e.get(r.url+"/movie-search/person/"+t).then(function(e){return o(e)},function(e){return n(e)})})},this.getPopularMovies=function(){return o(function(o,t){e.get(r.url+"/movie-search/popular").then(function(e){return o(e)},function(e){return t(e)})})}}]).service("MovieTrackService",["$http","CONFIG","$q",function(e,r,o){this.getAllTracked=function(){return o(function(o,t){e.get(r.url+"/movie-tracks/").then(function(e){return o(e)},function(e){return t({message:"Error loading tracked movies",error:e})})})},this.getTrackedMovies=function(t){return o(function(o,n){e.get(r.url+"/movie-tracks/"+t).then(function(e){return o(e)},function(e){return n({message:"Error loading tracked movies",error:e})})})}}]).service("timeService",["$filter","CONFIG",function(e,r){this.getToday=function(){return e("date")(new Date,r.dateFormat)}}]),angular.module("app.errorController",[]).controller("errorController",["$scope","$state","$window",function(e,r,o){e.error=o.error||r.params.error,o.error=null}]),angular.module("app.feed_controller",[]).controller("FeedController",["$rootScope","$scope","$state","$filter","$window","MovieTrackService","OMDBService",function(e,r,o,t,n,i,l){r.trackedMovies=[],r.popularMovies=[],i.getAllTracked().then(function(e){var o=r.trackedMovies=e.data;0==o.length&&(r.noTrackedMessage="No movies have been tracked yet!");for(var t=0;t<o.length;t++){var n=new Date(o[t].updatedDate).toLocaleTimeString().split(":"),i=new Date(o[t].updatedDate).toLocaleTimeString().split(" ")[1];r.trackedMovies[t].time=n[0].toString()+":"+n[1].toString()+" "+i}},function(e){console.error(e)})}]),angular.module("app.homeController",[]).controller("HomepageController",["$rootScope","$scope","$state","$filter","$window","MovieTrackService","OMDBService",function(e,r,o,t,n,i,l){r.popularMovies=[],r.myInterval=5e3,r.noWrapSlides=!1,r.active=0;var a=(r.popularSlides=[],0);l.getPopularMovies().then(function(e){for(var o=r.popularMovies=e.data.results,t=0;t<5;t++)r.popularSlides.push({image:"https://image.tmdb.org/t/p/w1920"+o[t].backdrop_path,title:o[t].title,id:a++})},function(e){console.error(e)})}]),angular.module("app.login_controllers",[]).controller("LoginController",["$rootScope","$scope","$state","Auth",function(e,r,o,t){r.credentials={username:"",password:""},r.loginError=null,r.login=function(){r.loginError=null,t.login(r.credentials.email,r.credentials.password).then(function(r){e.currentUser=r,o.go("index.profile")},function(e){console.error("Error while logging in: ",e),r.loginError=e.data})}}]),angular.module("app.controllers",["app.main_controllers","app.errorController","app.homeController","app.login_controllers","app.profile_controller","app.register_controller","app.movies_controller","app.movie_controller","app.person_controller","app.feed_controller"]),angular.module("app.main_controllers",[]).controller("MainController",["$rootScope","$scope","$state","$filter","$window","timeService","Auth",function(e,r,o,t,n,i,l){e.currentUser=null,e.today=i.getToday(),e.currentYear=new Date(e.today).getFullYear(),e.rightNow=new Date,r.logout=function(){l.logout().then(function(e){console.log("The logout response: ",e),n.location.reload()})}}]).controller("NavigationController",["$rootScope","$scope","$state",function(e,r,o){r.nav="Navigation Text"}]).controller("uibCarousel",function(){}),angular.module("app.movie_controller",[]).controller("MovieController",["$rootScope","$scope","$state","$stateParams","MovieService","OMDBService",function(e,r,o,t,n,i){r.movieError=null,r.movie=null,r.dataLoading=!1;var l=function(){r.dataLoading=!0,i.getMovieById(t.movieId).then(function(e){r.movie=e.data,i.getMovieCreditsById(t.movieId).then(function(e){r.movie.credits=e.data,r.dataLoading=!1},function(e){console.error("Error loading movie credits: ",e),r.movieError=e}),i.getMovieImagesById(t.movieId).then(function(e){r.movie.images=e.data},function(e){console.error("Error loading movie images: ",e),r.movieError=e})},function(e){console.error("Error loading movie information: ",e),r.movieError=e})};l()}]),angular.module("app.movies_controller",[]).controller("MoviesController",["$rootScope","$scope","$state","MovieService","OMDBService",function(e,r,o,t,n){r.moviesError=null,r.movies=null,r.noMovies=null,r.dataLoading=!1,r.movie_search={search:""},r.getMovies=function(e){r.movies=null,r.noMovies=null,r.dataLoading=!0,n.getMoviesByTitle(e).then(function(e){r.movies=e.data.results,0==r.movies.length&&(r.noMovies="No movies for search words"),r.dataLoading=!1},function(e){console.error(e),r.noMovies=e})}}]),angular.module("app.person_controller",[]).controller("PersonController",["$rootScope","$scope","$state","$stateParams","MovieService","OMDBService",function(e,r,o,t,n,i){r.personError=null,r.person=null,r.dataLoading=!1;var l=function(){r.dataLoading=!0,i.getPersonById(t.personId).then(function(e){r.person=e.data,r.dataLoading=!1},function(e){console.error("Error loading person information: ",e),r.personError=e})};l()}]),angular.module("app.profile_controller",[]).controller("ProfileController",["$rootScope","$scope","Auth","ngDialog","MovieTrackService",function(e,r,o,t,n){r.trackedMovies=[],r.trackMovie=function(){t.open({template:"../templates/dialogs/track_movie.html",className:"ngdialog-theme-default track_movie",width:900,showClose:!0,controller:"TrackMovieController",closeByNavigation:!0})},e.$on("reloadTrackedMovies",function(){n.getTrackedMovies(e.currentUser.id).then(function(e){r.trackedMovies=e.data},function(e){console.error(e)})}),e.$broadcast("reloadTrackedMovies")}]).controller("TrackMovieController",["$rootScope","$scope","$timeout","$http","CONFIG","ngDialog","OMDBService",function(e,r,o,t,n,i,l){r.movie_search="",r.search_items=[],r.chosen={movie:null},r.movie_selected=!1,r.tracked={date_watched:r.today,review_text:"",rating:""},r.trackError=null,r.getNewResults=function(){l.getMoviesByTitle(r.movie_search).then(function(e){r.search_items=e.data.results},function(e){console.error(e)})},r.selectMovie=function(e){r.chosen.movie=e,r.movie_selected=!0,r.movie_search="",r.search_items=[]},r.backToSelect=function(){r.movie_selected=!1,r.chosen.movie=null},r.saveMovieTrack=function(){r.chosen.movie.omdbId=r.chosen.movie.id,t.post(n.url+"/movie-tracks",{movie:r.chosen.movie,tracked:r.tracked,userId:e.currentUser.id}).then(function(r){console.log("The movie track response: ",r),i.close(),e.$broadcast("reloadTrackedMovies")},function(e){console.error(e),r.trackError=e})}}]),angular.module("app.register_controller",[]).controller("RegisterController",["$rootScope","$scope","$state","Auth",function(e,r,o,t){r.form={firstName:"",lastName:"",email:"",password:"",confirmPassword:""},r.registerError=null,r.signup=function(){r.registerError=null,t.register(r.form).then(function(r){console.log("The register response: ",r),e.currentUser=r.data,o.go("index.profile")},function(e){console.error("Error while registering: ",e),r.registerError=e.data})}}]);